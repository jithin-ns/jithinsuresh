(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{vbIl:function(e,t,i){"use strict";i.r(t),i.d(t,"OfferingsModule",function(){return E});var n=i("ofXK"),o=i("tyNb"),s=i("mrSG"),a=i("3Pt+"),r=i("52Kp"),c=i("DFWg"),f=i("e8pF"),g=i("SqtC"),l=i("xauc"),b=i("N26v"),d=i("fXoL"),u=i("sYmb"),h=i("1R7j");let m=(()=>{class e{constructor(e){this.translate=e,this.offeringDate=null,this.advanceBookingFormGroup=new a.f({}),this.offeringDateObj=new d.n}ngOnInit(){this.translate.get(["pages.admin.date","form.validationErrors.mandatory"]).subscribe(e=>{this.initialize(e)})}initialize(e){this.advanceBookingFormConfig={type:"date",name:"offeringDate",label:e["pages.admin.date"],placeholder:e["pages.admin.date"],defaultValue:this.offeringDate?this.offeringDate:Object(l.e)(),minDate:Object(l.e)(),tabIndex:"0",parentClass:"m-0",validators:[Object.assign(Object.assign({},l.c.required),{validationMsg:e["form.validationErrors.mandatory"]})]},this.advanceBookingFormGroup=Object(l.d)([this.advanceBookingFormConfig],this.advanceBookingFormGroup)}cancel(){this.offeringDateObj.emit({action:"cancel",date:null})}setOfferingDate(){const e={action:"submit",date:this.advanceBookingFormGroup.get("offeringDate").value};this.offeringDateObj.emit(e)}}return e.\u0275fac=function(t){return new(t||e)(d.Lb(u.e))},e.\u0275cmp=d.Fb({type:e,selectors:[["app-advance-booking"]],inputs:{offeringDate:"offeringDate"},outputs:{offeringDateObj:"offeringDateObj"},decls:16,vars:2,consts:[[1,"modal-content"],[1,"modal-header"],["translate","",1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"row"],[1,"col-12"],["appFormElement","",3,"config","group"],[1,"modal-footer"],["type","button","translate","",1,"btn","btn-light","px-4",3,"click"],["type","button","translate","",1,"btn","btn-success","px-4",3,"click"]],template:function(e,t){1&e&&(d.Rb(0,"div",0),d.Rb(1,"div",1),d.Rb(2,"h5",2),d.yc(3,"pages.offerings.advanceBooking"),d.Qb(),d.Rb(4,"button",3),d.bc("click",function(){return t.cancel()}),d.Rb(5,"span",4),d.yc(6,"\xd7"),d.Qb(),d.Qb(),d.Qb(),d.Rb(7,"div",5),d.Rb(8,"div",6),d.Rb(9,"div",7),d.Nb(10,8),d.Qb(),d.Qb(),d.Qb(),d.Rb(11,"div",9),d.Rb(12,"button",10),d.bc("click",function(){return t.cancel()}),d.yc(13," general.cancel "),d.Qb(),d.Rb(14,"button",11),d.bc("click",function(){return t.setOfferingDate()}),d.yc(15," general.submit "),d.Qb(),d.Qb(),d.Qb()),2&e&&(d.yb(10),d.ic("config",t.advanceBookingFormConfig)("group",t.advanceBookingFormGroup))},directives:[u.a,h.a],styles:[""]}),e})();var p=i("UvjE"),v=i("1kSV"),O=i("o7N+"),y=i("B43R"),S=i("qfBg"),x=i("F4oO"),j=i("7A/B");function k(e,t){if(1&e){const e=d.Sb();d.Rb(0,"a",20),d.bc("click",function(){d.rc(e);const t=d.dc(3).index;return d.dc().deleteOffering(t)}),d.Mb(1,"app-image-icon",21),d.ec(2,"translate"),d.Qb()}2&e&&(d.yb(1),d.ic("url","delete_cross.png")("alternateText",d.fc(2,3,"general.delete"))("parentClass","person-cart"))}function R(e,t){if(1&e&&(d.Rb(0,"button",17),d.yc(1),d.Qb(),d.Rb(2,"span",18),d.yc(3),d.Qb(),d.wc(4,k,3,5,"a",19)),2&e){const e=d.dc(2).$implicit,t=d.dc();d.yb(1),d.Ac(" ",e.index," "),d.yb(2),d.zc(e.title),d.yb(1),d.ic("ngIf",t.validOfferings>1)}}function D(e,t){1&e&&d.wc(0,R,5,3,"ng-template",16)}function Q(e,t){if(1&e&&(d.Rb(0,"div",30),d.Rb(1,"label",31),d.yc(2," pages.offerings.offeringTotal "),d.Qb(),d.Rb(3,"label",32),d.yc(4),d.Qb(),d.Qb()),2&e){const e=d.dc(3).$implicit,t=d.dc();d.yb(4),d.Bc(" ",t.currency," ",e.totalAmount,"/- ")}}function w(e,t){if(1&e){const e=d.Sb();d.Rb(0,"app-offering-form",23),d.bc("offeringDeleted",function(){d.rc(e);const t=d.dc(2).index;return d.dc().calculateOfferingPrice(t)}),d.Qb(),d.wc(1,Q,5,2,"div",24),d.Rb(2,"div",25),d.Rb(3,"button",26),d.bc("click",function(){d.rc(e);const t=d.dc(2),i=t.index,n=t.$implicit;return d.dc().addPersons(i,n.persons.length)}),d.yc(4," pages.offerings.addPerson "),d.Qb(),d.Qb(),d.Rb(5,"div",27),d.Rb(6,"span",28),d.yc(7),d.Qb(),d.Rb(8,"a",29),d.bc("click",function(){d.rc(e);const t=d.dc(2).index;return d.dc().openAdvanceBookingForm(t)}),d.yc(9," pages.offerings.advanceBooking "),d.Qb(),d.Qb()}if(2&e){const e=d.dc(2).$implicit,t=d.dc();d.ic("formConfig",e)("formGroup",t.formGroup)("changeFlag",t.changeFlag)("existingDevotees",t.existingDevotees),d.yb(1),d.ic("ngIf",e.totalAmount),d.yb(6),d.Ac(" ",e.offeringDateText," ")}}function C(e,t){1&e&&d.wc(0,w,10,6,"ng-template",22)}function G(e,t){if(1&e&&(d.Rb(0,"ngb-panel",14),d.wc(1,D,1,0,void 0,15),d.wc(2,C,1,0,void 0,15),d.Qb()),2&e){const e=t.$implicit;d.kc("id","accordion-",t.index,""),d.jc("cardClass",e.active?"":"d-none"),d.yb(1),d.ic("ngIf",e.active),d.yb(1),d.ic("ngIf",e.active)}}const I=[{path:"",component:(()=>{class e{constructor(e,t,i,n,o,s){this.router=e,this.translate=t,this.modalService=i,this.offeringsService=n,this.utilsService=o,this.userService=s,this.formGroup=new a.f({}),this.offerings=[],this.assetsBasePath=c.a,this.validOfferings=0,this.existingDevotees=[],this.currency=c.b,this.isLoggedIn=!1,this.changeFlag=!1}ngOnInit(){this.isLoggedIn=this.userService.isAuthenticated(),this.translate.get(["pages.offerings.offering","pages.offerings.name","pages.offerings.star","pages.admin.date","form.validationErrors.mandatory"]).subscribe(e=>{this.translations=e,this.initialize()})}initialize(){return Object(s.a)(this,void 0,void 0,function*(){yield this.getAllOfferings(),yield this.getAllStars(),this.utilsService.getStorageValue(f.e)&&this.getExistingDevotees(),this.utilsService.getStorageValue(f.c)&&this.utilsService.isBase64(this.utilsService.getStorageValue(f.c))?(JSON.parse(r.a.decode(this.utilsService.getStorageValue(f.c))).offeringsData.forEach((e,t)=>{this.addOffering(t,e.offering),e.persons.forEach((e,i)=>{this.addPersons(t,i,e)})}),this.utilsService.removeStorageValue(f.c)):this.addOffering(0)})}getExistingDevotees(){const e=this.utilsService.getStorageValue(f.e),t=this.utilsService.getLanguageExtension();this.offeringsService.getExistingDevotees(e).subscribe(e=>{this.existingDevotees=e&&e.data?Object(b.b)(e.data,t):[]})}getAllOfferings(){return new Promise(e=>{this.offeringsService.getAllOfferings().subscribe(t=>{const i=this.utilsService.getLanguageExtension();this.offeringList=t&&t.data?Object(b.f)(t.data,i):[],e(1)})})}getAllStars(){return new Promise(e=>{this.offeringsService.getAllStars().subscribe(t=>{const i=this.utilsService.getLanguageExtension();this.starsList=t&&t.data?Object(b.h)(t.data,i):[],e(1)})})}addOffering(e,t=null){const i=this.offeringsService.getOfferingConfigName(e),n={type:"autocomplete",name:i,placeholder:this.translations["pages.offerings.offering"],defaultValue:t,tabIndex:"0",options:this.offeringList,validators:[Object.assign(Object.assign({},l.c.required),{validationMsg:this.translations["form.validationErrors.mandatory"]})]},o={index:e+1,active:!0,title:t?t.label:"",offering:n,persons:[],totalAmount:0,offeringDate:t?t.offeringDate:Object(l.e)(),offeringDateText:""};this.formGroup=Object(l.d)([o.offering],this.formGroup),this.offerings.push(o),this.formGroup.get(i).valueChanges.subscribe(t=>{t&&t.label&&t.value?(this.calculateOfferingPrice(e),this.offerings[e].title=t.label):this.offerings[e].title=""}),this.activeId="accordion-"+e.toString(),this.resetIndex(),t||this.addPersons(e,0)}calculateOfferingPrice(e){const t=this.offeringsService.getOfferingConfigName(e),i=this.formGroup.get(t).value;if(i&&i.value){const t=this.offerings[e].persons.filter(e=>e.active).length;this.offerings[e].totalAmount=i.value.price*t}else this.offerings[e].totalAmount=0}addPersons(e,t,i=null){const n={active:!0,name:{type:"text",name:this.offeringsService.getPersonConfigName(e,t),defaultValue:i&&i.name?i.name:"",placeholder:this.translations["pages.offerings.name"],tabIndex:"0",validators:[Object.assign(Object.assign({},l.c.required),{validationMsg:this.translations["form.validationErrors.mandatory"]})]},star:{type:"select",name:this.offeringsService.getStarConfigName(e,t),defaultValue:i&&i.star?i.star:"",placeholder:this.translations["pages.offerings.star"],tabIndex:"0",options:this.starsList,validators:[Object.assign(Object.assign({},l.c.required),{validationMsg:this.translations["form.validationErrors.mandatory"]})]}};this.formGroup=Object(l.d)([n.name,n.star],this.formGroup),this.offerings[e].persons.push(n),this.changeFlag=!this.changeFlag,this.calculateOfferingPrice(e)}deleteOffering(e){this.offerings[e].active=!1;const t=this.offeringsService.getOfferingConfigName(e);this.formGroup.removeControl(t),this.offerings[e].persons.forEach(e=>{this.formGroup.removeControl(e.name.name),this.formGroup.removeControl(e.star.name)}),this.resetIndex()}openAdvanceBookingForm(e){const t=this.modalService.open(m,{centered:!0});t.componentInstance.offeringDate=this.offerings[e].offeringDate,t.componentInstance.offeringDateObj.subscribe(i=>{if("submit"===i.action)if(this.offerings[e].offeringDate=i.date,JSON.stringify(Object(l.e)())===JSON.stringify(i.date))this.offerings[e].offeringDateText="";else{const t=Object(l.a)(i.date);this.offerings[e].offeringDateText=this.utilsService.date(t).format(p.a)}t.close()})}resetIndex(){let e=0;this.offerings.forEach(t=>{t.active&&(t.index=++e),this.validOfferings=e})}submit(){if(this.formGroup.valid){const e={offeringsData:this.offeringsService.OfferingDataToCart(this.formGroup.value,this.offerings),recurringData:null};this.utilsService.setStorageValue(f.c,r.a.encode(JSON.stringify(e)));const t=this.isLoggedIn?[g.d,g.e].join("/"):g.e;this.router.navigate([[t].join("/")])}else{this.formGroup=Object(l.f)(this.formGroup);let e=0,t=0;for(let i of this.offerings){if(i.active){if(this.formGroup.get(i.offering.name).invalid){e=t;break}for(let n of i.persons)if(n.active&&(this.formGroup.get(n.name.name).invalid||this.formGroup.get(n.star.name).invalid)){e=t;break}}t++}this.activeId="accordion-"+e.toString()}}}return e.\u0275fac=function(t){return new(t||e)(d.Lb(o.b),d.Lb(u.e),d.Lb(v.h),d.Lb(O.a),d.Lb(y.a),d.Lb(S.a))},e.\u0275cmp=d.Fb({type:e,selectors:[["app-offerings"]],decls:19,vars:4,consts:[[1,"w-100","h-100","d-flex","flex-column","justify-content-start","align-items-center","offerings-container"],[1,"w-100","px-2"],[1,"row"],[1,"col-12","py-4","text-center"],["translate","",1,"h4"],["autocomplete","off",3,"formGroup"],[1,"col-12"],[3,"closeOthers","activeIds"],[3,"id","cardClass",4,"ngFor","ngForOf"],[1,"col-12","py-2"],[1,"d-flex","justify-content-center"],["type","button","translate","",1,"btn","btn-primary","tms-button",3,"click"],[1,"col-12","pt-4"],["type","button","translate","",1,"btn","btn-success","tms-button",3,"click"],[3,"id","cardClass"],[4,"ngIf"],["ngbPanelTitle",""],[1,"offering-index","float-left"],[1,"float-left"],["href","javascript: void(0)","class","position-absolute delete-offering",3,"click",4,"ngIf"],["href","javascript: void(0)",1,"position-absolute","delete-offering",3,"click"],[3,"url","alternateText","parentClass"],["ngbPanelContent",""],[3,"formConfig","formGroup","changeFlag","existingDevotees","offeringDeleted"],["class","w-100 mt-2",4,"ngIf"],[1,"w-100"],["type","button","translate","",1,"btn","btn-info","tms-button","mt-2",3,"click"],[1,"w-100","mt-2","d-flex","justify-content-between","align-items-center"],[1,"font-italic"],["href","javascript:void(0);","translate","",1,"advance-booking-link",3,"click"],[1,"w-100","mt-2"],["translate","",1,"float-left","font-weight-bold","offering-amount"],[1,"float-right","font-weight-bold","offering-amount"]],template:function(e,t){1&e&&(d.Rb(0,"div",0),d.Rb(1,"div",1),d.Rb(2,"div",2),d.Rb(3,"div",3),d.Rb(4,"p",4),d.yc(5,"pages.offerings.enterOfferigs"),d.Qb(),d.Qb(),d.Qb(),d.Rb(6,"form",5),d.Rb(7,"div",2),d.Rb(8,"div",6),d.Rb(9,"ngb-accordion",7),d.wc(10,G,3,4,"ngb-panel",8),d.Qb(),d.Qb(),d.Rb(11,"div",9),d.Rb(12,"div",10),d.Rb(13,"button",11),d.bc("click",function(){return t.addOffering(t.offerings.length)}),d.yc(14," pages.offerings.addOffering "),d.Qb(),d.Qb(),d.Qb(),d.Rb(15,"div",12),d.Rb(16,"div",10),d.Rb(17,"button",13),d.bc("click",function(){return t.submit()}),d.yc(18," general.submit "),d.Qb(),d.Qb(),d.Qb(),d.Qb(),d.Qb(),d.Qb(),d.Qb()),2&e&&(d.yb(6),d.ic("formGroup",t.formGroup),d.yb(3),d.jc("activeIds",t.activeId),d.ic("closeOthers",!0),d.yb(1),d.ic("ngForOf",t.offerings))},directives:[u.a,a.u,a.l,a.g,v.a,n.j,v.l,n.k,v.n,x.a,v.m,j.a],pipes:[u.d],styles:[".offerings-container[_ngcontent-%COMP%]   .offering-amount[_ngcontent-%COMP%]{font-weight:700}.offerings-container[_ngcontent-%COMP%]   .advance-booking-link[_ngcontent-%COMP%]{font-size:14px}"]}),e})()}];let F=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=d.Jb({type:e}),e.\u0275inj=d.Ib({imports:[[o.e.forChild(I)],o.e]}),e})();var P=i("omz/"),B=i("ZtcU");let E=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=d.Jb({type:e}),e.\u0275inj=d.Ib({imports:[[n.b,F,u.c,v.b,P.a,B.a]]}),e})()}}]);