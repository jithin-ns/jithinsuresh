(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{N26v:function(e,t,r){"use strict";r.d(t,"c",function(){return s}),r.d(t,"a",function(){return f}),r.d(t,"f",function(){return c}),r.d(t,"h",function(){return g}),r.d(t,"i",function(){return l}),r.d(t,"e",function(){return u}),r.d(t,"j",function(){return d}),r.d(t,"b",function(){return p}),r.d(t,"d",function(){return b}),r.d(t,"g",function(){return m});var n=r("UvjE"),i=r("DFWg"),a=r("wd/R"),o=r("xauc");function s(e){let t=[];return e&&Array.isArray(e)&&(t=e.map(e=>({offering:Number(e.offering.value.id),offeringDate:e.offering.offeringDate?a(Object(o.a)(e.offering.offeringDate)).startOf("day").format(n.c):a().startOf("day").format(n.c),persons:e.persons.map(e=>({name:e.name,star:Number(e.star.value)}))}))),t}function f(e){let t;return e&&(t={offeringEn:e.nameEnglish?e.nameEnglish:"",offeringRg:e.nameRegional?e.nameRegional:e.nameEnglish?e.nameEnglish:"",description:e.description?e.description:"",price:e.amount?Number(e.amount):0}),t}function c(e,t){return e.map(e=>({label:e["offering"+t]?e["offering"+t]:"",value:{id:e.id?e.id:0,label:e["offering"+t]?e["offering"+t]:"",price:e.price?e.price:0}}))}function g(e,t){return e.map(e=>({label:e["star"+t]?e["star"+t]:"",value:{label:e["star"+t]?e["star"+t]:"",value:e.id?e.id:0}}))}function l(e,t){let r=null;return e&&(r={transactionId:e.transaction_id?e.transaction_id:"",transactionStatus:e.transaction_status?e.transaction_status:i.k,transactionDate:e.transaction_time?a(e.transaction_time).format(n.a):"",transactionTime:e.transaction_time?a(e.transaction_time).format(n.d):"",offerings:e.offerings?e.offerings.map(e=>({offering:e["offering"+t]?e["offering"+t]:"",offeringId:e.offering_id?e.offering_id:0,price:e.price?e.price:0,offeringDate:e.offering_date?a(e.offering_date).format(n.a):"",devotees:e.devotees?e.devotees.map(e=>({devoteeId:e.devotee_id?e.devotee_id:0,name:e.name?e.name:"",starId:e.star_id?e.star_id:"",star:e["star"+t]?e["star"+t]:""})):[]})):[]}),r}function u(e){return e.map(e=>({id:e.id?e.id:0,offering_en:e.offering_en?e.offering_en:"",offering_rg:e.offering_rg?e.offering_rg:"",description:e.description?e.description:"",price:e.price?e.price:0}))}function d(e){return{offeringEn:e.offering_en?e.offering_en:"",offeringRg:e.offering_rg?e.offering_rg:"",description:e.description?e.description:"",price:e.price?Number(e.price):0}}function p(e,t){let r=[];return e&&Array.isArray(e)&&(r=e.map(e=>({name:e.name?e.name:"",star:e["star"+t]?e["star"+t]:"",starId:e.star_id?e.star_id:0}))),r}function b(e,t){let r=[];return e&&Array.isArray(e)&&(r=e.map(e=>({offeringId:e.offering_id?e.offering_id:0,offering:e["offering"+t]?e["offering"+t]:"",devoteeId:e.devotee_id?e.devotee_id:0,devotee:e.name?e.name:"",starId:e.star_id?e.star_id:0,star:e["star"+t]?e["star"+t]:"",offeringDate:e.offering_date?a(e.offering_date).format(n.a):"",amount:e.amount?e.amount:0,userId:e.user_id?e.user_id:0,phoneNumber:e.phone_number?e.phone_number:"",bookingDate:e.created_time?a(e.created_time).format(n.a):"",status:e.status?e.status:"",isAdvanceBooking:!(!e.offering_date||!e.created_time)&&a(e.offering_date).isAfter(e.created_time,"day")}))),r}function m(e){let t=[];if(e)if(e.isDates)e.dates&&Array.isArray(e.dates)&&e.dates.forEach(e=>{t.push(e.apiFormat)});else{const r=Object(o.a)(e.startDate),i=e.recurrenceType&&e.recurrenceType.value&&"weekly"===e.recurrenceType.value?"weeks":e.recurrenceType&&e.recurrenceType.value&&"monthly"===e.recurrenceType.value?"months":"years",s=e.recurrences?e.recurrences:0;let f=0;for(;f<s;){const e=a(r).add(f,i).startOf("day").format(n.c);t.push(e),f++}}return t.length?t:null}},mGIa:function(e,t,r){"use strict";r.r(t),r.d(t,"HistoryModule",function(){return D});var n=r("ofXK"),i=r("tyNb"),a=r("3Pt+"),o=r("UvjE"),s=r("xauc"),f=r("N26v"),c=r("fXoL"),g=r("sYmb"),l=r("B43R"),u=r("o7N+"),d=r("1R7j"),p=r("DFWg"),b=r("1kSV");function m(e,t){if(1&e&&(c.Rb(0,"ngb-alert",14),c.yc(1),c.Qb()),2&e){const e=c.dc();c.ic("type","warning")("dismissible",!1),c.yb(1),c.Ac(" ",null==e.offering?null:e.offering.status," ")}}function h(e,t){1&e&&(c.Rb(0,"ngb-alert",15),c.yc(1," pages.offerings.advanceBooking "),c.Qb()),2&e&&c.ic("type","info")("dismissible",!1)}let y=(()=>{class e{constructor(){this.currency=p.b}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=c.Fb({type:e,selectors:[["app-history-list-item"]],inputs:{offering:"offering"},decls:34,vars:9,consts:[[1,"w-100","py-1","offering-list-item-container"],[1,"card"],[1,"card-body"],[1,"row"],[1,"col-12","d-flex","justify-content-between"],[1,"font-weight-bold"],[1,"col-12"],[1,"mr-1"],[1,"col-6"],["translate","",1,"mr-2","history-label"],[1,"col-5","px-1","text-align-left"],["class","m-0 py-1 px-3 float-left text-center text-capitalize",3,"type","dismissible",4,"ngIf"],[1,"col-7","px-1","text-align-left"],["class","m-0 py-1 px-3 float-right text-center","translate","",3,"type","dismissible",4,"ngIf"],[1,"m-0","py-1","px-3","float-left","text-center","text-capitalize",3,"type","dismissible"],["translate","",1,"m-0","py-1","px-3","float-right","text-center",3,"type","dismissible"]],template:function(e,t){1&e&&(c.Rb(0,"div",0),c.Rb(1,"div",1),c.Rb(2,"div",2),c.Rb(3,"div",3),c.Rb(4,"div",4),c.Rb(5,"label",5),c.yc(6),c.Qb(),c.Rb(7,"label",5),c.yc(8),c.Qb(),c.Qb(),c.Qb(),c.Rb(9,"div",3),c.Rb(10,"div",6),c.Rb(11,"label",7),c.yc(12),c.Qb(),c.Rb(13,"label"),c.yc(14),c.Qb(),c.Qb(),c.Qb(),c.Rb(15,"div",3),c.Rb(16,"div",8),c.Rb(17,"label",9),c.yc(18," pages.admin.offeringDate "),c.Qb(),c.Qb(),c.Rb(19,"div",8),c.Rb(20,"label",5),c.yc(21),c.Qb(),c.Qb(),c.Qb(),c.Rb(22,"div",3),c.Rb(23,"div",8),c.Rb(24,"label",9),c.yc(25," pages.admin.bookingDate "),c.Qb(),c.Qb(),c.Rb(26,"div",8),c.Rb(27,"label",5),c.yc(28),c.Qb(),c.Qb(),c.Qb(),c.Rb(29,"div",3),c.Rb(30,"div",10),c.wc(31,m,2,3,"ngb-alert",11),c.Qb(),c.Rb(32,"div",12),c.wc(33,h,2,2,"ngb-alert",13),c.Qb(),c.Qb(),c.Qb(),c.Qb(),c.Qb()),2&e&&(c.yb(6),c.Ac(" ",null==t.offering?null:t.offering.offering," "),c.yb(2),c.Bc(" ",t.currency," ",null==t.offering?null:t.offering.amount,"/- "),c.yb(4),c.Ac("",null==t.offering?null:t.offering.devotee,","),c.yb(2),c.zc(null==t.offering?null:t.offering.star),c.yb(7),c.zc(null==t.offering?null:t.offering.offeringDate),c.yb(7),c.zc(null==t.offering?null:t.offering.bookingDate),c.yb(3),c.ic("ngIf","incomplete"===(null==t.offering?null:t.offering.status)),c.yb(2),c.ic("ngIf",null==t.offering?null:t.offering.isAdvanceBooking))},directives:[g.a,n.k,b.c],styles:[".offering-list-item-container[_ngcontent-%COMP%]   .history-label[_ngcontent-%COMP%]{font-size:14px}"]}),e})();function v(e,t){1&e&&c.Mb(0,"app-history-list-item",14),2&e&&c.ic("offering",t.$implicit)}function R(e,t){1&e&&(c.Rb(0,"div",15),c.Rb(1,"label",16),c.yc(2,"general.nothingToList"),c.Qb(),c.Qb())}const _=[{path:"",component:(()=>{class e{constructor(e,t,r){this.translate=e,this.utilsService=t,this.offeringsService=r,this.offerings=[],this.formGroup=new a.f({})}ngOnInit(){this.translate.get(["pages.admin.search","pages.admin.sortBy","pages.admin.regionalName","pages.admin.englishName","pages.admin.price","pages.admin.ascending","pages.admin.descending","pages.admin.from","pages.admin.to","pages.admin.date"]).subscribe(e=>{this.setupSearchForm(e)}),this.getTransactions()}setupSearchForm(e){this.formConfig={from:{type:"date",name:"fromDate",label:e["pages.admin.date"],placeholder:e["pages.admin.date"],defaultValue:Object(s.e)(),feed:{formControl:"toDate",property:"maxDate"},tabIndex:"0",parentClass:"m-0"},to:{type:"date",name:"toDate",label:e["pages.admin.to"],placeholder:e["pages.admin.to"],defaultValue:Object(s.e)(),feed:{formControl:"fromDate",property:"minDate"},tabIndex:"1",parentClass:"m-0"}},this.formGroup=Object(s.d)([this.formConfig.from,this.formConfig.to],this.formGroup)}getTransactions(){let e=this.formGroup.get("fromDate").value?Object(s.a)(this.formGroup.get("fromDate").value):Object(s.a)(),t=this.formGroup.get("toDate").value?Object(s.a)(this.formGroup.get("toDate").value):Object(s.a)();const r=this.utilsService.date(e).startOf("day").format(o.c),n=this.utilsService.date(t).endOf("day").format(o.c);this.offeringsService.getOfferingsHistory(r,n).subscribe(e=>{const t=this.utilsService.getLanguageExtension();this.offerings=e&&e.data?Object(f.d)(e.data,t):[]})}}return e.\u0275fac=function(t){return new(t||e)(c.Lb(g.e),c.Lb(l.a),c.Lb(u.a))},e.\u0275cmp=c.Fb({type:e,selectors:[["app-history"]],decls:18,vars:6,consts:[[1,"w-100","h-100","d-flex","flex-column","history-container"],[1,"row"],[1,"col-12","py-4","text-center"],["translate","",1,"h4"],[1,"row","mb-2"],[1,"col-6"],["appFormElement","",1,"w-100",3,"config","group"],[1,"row","justify-content-end"],[1,"col-4"],["type","button","translate","",1,"btn","btn-success","tms-button","mt-2","search-btn",3,"click"],[1,"row","mt-2"],[1,"col-12"],[3,"offering",4,"ngFor","ngForOf"],["class","col-12 pt-4 text-center",4,"ngIf"],[3,"offering"],[1,"col-12","pt-4","text-center"],["translate","",1,"h5"]],template:function(e,t){1&e&&(c.Rb(0,"div",0),c.Rb(1,"div",1),c.Rb(2,"div",2),c.Rb(3,"p",3),c.yc(4,"pages.offerings.offerings"),c.Qb(),c.Qb(),c.Qb(),c.Rb(5,"div",4),c.Rb(6,"div",5),c.Nb(7,6),c.Qb(),c.Rb(8,"div",5),c.Nb(9,6),c.Qb(),c.Qb(),c.Rb(10,"div",7),c.Rb(11,"div",8),c.Rb(12,"button",9),c.bc("click",function(){return t.getTransactions()}),c.yc(13," pages.admin.search "),c.Qb(),c.Qb(),c.Qb(),c.Rb(14,"div",10),c.Rb(15,"div",11),c.wc(16,v,1,1,"app-history-list-item",12),c.Qb(),c.wc(17,R,3,0,"div",13),c.Qb(),c.Qb()),2&e&&(c.yb(7),c.ic("config",t.formConfig.from)("group",t.formGroup),c.yb(2),c.ic("config",t.formConfig.to)("group",t.formGroup),c.yb(7),c.ic("ngForOf",t.offerings),c.yb(1),c.ic("ngIf",!t.offerings||!t.offerings.length))},directives:[g.a,d.a,n.j,n.k,y],styles:[""]}),e})()}];let x=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.Jb({type:e}),e.\u0275inj=c.Ib({imports:[[i.e.forChild(_)],i.e]}),e})();var Q=r("biST"),O=r("omz/");let D=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.Jb({type:e}),e.\u0275inj=c.Ib({imports:[[n.b,x,Q.a,O.a,g.c,b.d]]}),e})()},"o7N+":function(e,t,r){"use strict";r.d(t,"a",function(){return s});var n=r("uY3Z"),i=r("xauc"),a=r("fXoL"),o=r("bP2Y");let s=(()=>{class e{constructor(e){this.httpService=e,this.offeringPrefix="offering",this.namePrefix="name",this.starPrefix="star",this.separator="_"}getAllOfferings(e){return this.httpService.httpRequest(e?n.a.offerings+"?page="+e.page+"&limit="+e.limit+"&search="+e.search+"&orderBy="+e.sortBy+"&sortOrder="+e.sortOrder:n.a.offerings,"get")}getAllStars(){return this.httpService.httpRequest(n.a.stars,"get")}getOfferingConfigName(e){return this.offeringPrefix+this.separator+e}getPersonConfigName(e,t){return this.namePrefix+this.separator+e+this.separator+t}getStarConfigName(e,t){return this.starPrefix+this.separator+e+this.separator+t}OfferingDataToCart(e,t){let r=[];if(e)return Object.keys(e).forEach(n=>{const a=n.split(this.separator)[1];if(n.indexOf(this.namePrefix)>-1){const o=n.split(this.separator)[2];let s={offering:null,persons:[]};r[a]=r[a]?r[a]:s,r[a].offering=Object.assign(Object.assign({},e[this.offeringPrefix+this.separator+a]),{offeringDate:t[a].offeringDate?t[a].offeringDate:Object(i.e)()}),r[a].persons[o]={name:e[this.namePrefix+this.separator+a+this.separator+o],star:e[this.starPrefix+this.separator+a+this.separator+o]}}}),r=r.filter(e=>(e.persons=e.persons.filter(e=>null!==e),null!==e)),r}submitUserOffering(e){return this.httpService.httpRequest(n.a.submitOfferings,"post",e)}getTransactionDetails(e){return this.httpService.httpRequest(n.a.transactionDetails+"/"+e,"get")}getTransactionAmount(e){let t=0;return e.offerings.forEach(e=>{t+=e.price*e.devotees.length}),t}completeTransaction(e){return this.httpService.httpRequest(n.a.approveTransaction,"patch",{transactionId:e})}deleteOffering(e){return this.httpService.httpRequest(n.a.offerings+"/"+e.id,"delete")}addOffering(e){return this.httpService.httpRequest(n.a.offerings,e.id?"put":"post",e)}getOfferingDetails(e){return this.httpService.httpRequest(n.a.offerings+"/"+e,"get")}getExistingDevotees(e){return this.httpService.httpRequest(n.a.submitOfferings+"/"+e,"get")}getOfferingsHistory(e,t){let r=n.a.offeringHistory;return r+="?fromDate="+e,r+="&toDate="+t,this.httpService.httpRequest(r,"get")}}return e.\u0275fac=function(t){return new(t||e)(a.Yb(o.a))},e.\u0275prov=a.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);