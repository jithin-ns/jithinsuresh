(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{N26v:function(e,t,r){"use strict";r.d(t,"c",function(){return o}),r.d(t,"a",function(){return f}),r.d(t,"f",function(){return c}),r.d(t,"h",function(){return d}),r.d(t,"i",function(){return u}),r.d(t,"e",function(){return g}),r.d(t,"j",function(){return p}),r.d(t,"b",function(){return l}),r.d(t,"d",function(){return m}),r.d(t,"g",function(){return h});var i=r("UvjE"),n=r("DFWg"),a=r("wd/R"),s=r("xauc");function o(e){let t=[];return e&&Array.isArray(e)&&(t=e.map(e=>({offering:Number(e.offering.value.id),offeringDate:e.offering.offeringDate?a(Object(s.a)(e.offering.offeringDate)).startOf("day").format(i.c):a().startOf("day").format(i.c),persons:e.persons.map(e=>({name:e.name,star:Number(e.star.value)}))}))),t}function f(e){let t;return e&&(t={offeringEn:e.nameEnglish?e.nameEnglish:"",offeringRg:e.nameRegional?e.nameRegional:e.nameEnglish?e.nameEnglish:"",description:e.description?e.description:"",price:e.amount?Number(e.amount):0}),t}function c(e,t){return e.map(e=>({label:e["offering"+t]?e["offering"+t]:"",value:{id:e.id?e.id:0,label:e["offering"+t]?e["offering"+t]:"",price:e.price?e.price:0}}))}function d(e,t){return e.map(e=>({label:e["star"+t]?e["star"+t]:"",value:{label:e["star"+t]?e["star"+t]:"",value:e.id?e.id:0}}))}function u(e,t){let r=null;return e&&(r={transactionId:e.transaction_id?e.transaction_id:"",transactionStatus:e.transaction_status?e.transaction_status:n.k,transactionDate:e.transaction_time?a(e.transaction_time).format(i.a):"",transactionTime:e.transaction_time?a(e.transaction_time).format(i.d):"",offerings:e.offerings?e.offerings.map(e=>({offering:e["offering"+t]?e["offering"+t]:"",offeringId:e.offering_id?e.offering_id:0,price:e.price?e.price:0,offeringDate:e.offering_date?a(e.offering_date).format(i.a):"",devotees:e.devotees?e.devotees.map(e=>({devoteeId:e.devotee_id?e.devotee_id:0,name:e.name?e.name:"",starId:e.star_id?e.star_id:"",star:e["star"+t]?e["star"+t]:""})):[]})):[]}),r}function g(e){return e.map(e=>({id:e.id?e.id:0,offering_en:e.offering_en?e.offering_en:"",offering_rg:e.offering_rg?e.offering_rg:"",description:e.description?e.description:"",price:e.price?e.price:0}))}function p(e){return{offeringEn:e.offering_en?e.offering_en:"",offeringRg:e.offering_rg?e.offering_rg:"",description:e.description?e.description:"",price:e.price?Number(e.price):0}}function l(e,t){let r=[];return e&&Array.isArray(e)&&(r=e.map(e=>({name:e.name?e.name:"",star:e["star"+t]?e["star"+t]:"",starId:e.star_id?e.star_id:0}))),r}function m(e,t){let r=[];return e&&Array.isArray(e)&&(r=e.map(e=>({offeringId:e.offering_id?e.offering_id:0,offering:e["offering"+t]?e["offering"+t]:"",devoteeId:e.devotee_id?e.devotee_id:0,devotee:e.name?e.name:"",starId:e.star_id?e.star_id:0,star:e["star"+t]?e["star"+t]:"",offeringDate:e.offering_date?a(e.offering_date).format(i.a):"",amount:e.amount?e.amount:0,userId:e.user_id?e.user_id:0,phoneNumber:e.phone_number?e.phone_number:"",bookingDate:e.created_time?a(e.created_time).format(i.a):"",status:e.status?e.status:"",isAdvanceBooking:!(!e.offering_date||!e.created_time)&&a(e.offering_date).isAfter(e.created_time,"day")}))),r}function h(e){let t=[];if(e)if(e.isDates)e.dates&&Array.isArray(e.dates)&&e.dates.forEach(e=>{t.push(e.apiFormat)});else{const r=Object(s.a)(e.startDate),n=e.recurrenceType&&e.recurrenceType.value&&"weekly"===e.recurrenceType.value?"weeks":e.recurrenceType&&e.recurrenceType.value&&"monthly"===e.recurrenceType.value?"months":"years",o=e.recurrences?e.recurrences:0;let f=0;for(;f<o;){const e=a(r).add(f,n).startOf("day").format(i.c);t.push(e),f++}}return t.length?t:null}},l7Cu:function(e,t,r){"use strict";r.r(t),r.d(t,"FormModule",function(){return v});var i=r("ofXK"),n=r("tyNb"),a=r("3Pt+"),s=r("VYn8"),o=r("SqtC"),f=r("xauc"),c=r("N26v"),d=r("fXoL"),u=r("sYmb"),g=r("o7N+"),p=r("1R7j");function l(e,t){if(1&e&&(d.Rb(0,"div",8),d.Nb(1,9),d.Qb()),2&e){const e=t.$implicit,r=d.dc();d.yb(1),d.ic("config",e)("group",r.formGroup)}}const m=[{path:"",component:(()=>{class e{constructor(e,t,r,i){this.router=e,this.activatedRoute=t,this.translate=r,this.offeringsService=i,this.formGroup=new a.f({}),this.editId=null}ngOnInit(){this.activatedRoute.paramMap.subscribe(e=>{this.editId=e.get("id")}),this.translate.get(["pages.admin.createOffering","pages.admin.updateOffering","pages.admin.offeringNameEnglish","pages.admin.offeringNameRegional","pages.admin.description","pages.admin.amount","form.validationErrors.mandatory","form.validationErrors.invalid"]).subscribe(e=>{this.editId?(this.title=e["pages.admin.updateOffering"],this.getDetails(e)):(this.title=e["pages.admin.createOffering"],this.setUpForm(e))})}getDetails(e){this.offeringsService.getOfferingDetails(this.editId).subscribe(t=>{if(t&&t.data){const r=Object(c.j)(t.data);this.setUpForm(e,r)}else this.navigateToListingPage()})}setUpForm(e,t=null){this.formConfig=[{type:"text",name:"nameEnglish",label:e["pages.admin.offeringNameEnglish"],placeholder:e["pages.admin.offeringNameEnglish"],defaultValue:t?t.offeringEn:"",tabIndex:"0",validators:[Object.assign(Object.assign({},f.c.required),{validationMsg:e["form.validationErrors.mandatory"]})]},{type:"text",name:"nameRegional",label:e["pages.admin.offeringNameRegional"],placeholder:e["pages.admin.offeringNameRegional"],defaultValue:t?t.offeringRg:"",tabIndex:"1"},{type:"textarea",name:"description",label:e["pages.admin.description"],placeholder:e["pages.admin.description"],defaultValue:t?t.description:"",tabIndex:"2"},{type:"number",name:"amount",label:e["pages.admin.amount"],placeholder:e["pages.admin.amount"],defaultValue:t?t.price:"",tabIndex:"3",validators:[Object.assign(Object.assign({},f.c.required),{validationMsg:e["form.validationErrors.mandatory"]}),Object.assign(Object.assign({},f.c.pattern(s.a)),{validationMsg:e["form.validationErrors.invalid"]})]}],this.formGroup=Object(f.d)(this.formConfig,this.formGroup)}submit(){if(this.formGroup.valid){let e=Object(c.a)(this.formGroup.value);this.editId&&(e.id=Number(this.editId)),this.offeringsService.addOffering(e).subscribe(e=>{this.navigateToListingPage()})}else this.formGroup=Object(f.f)(this.formGroup)}navigateToListingPage(){const e=[o.d,o.r,o.o].join("/");this.router.navigate([e])}}return e.\u0275fac=function(t){return new(t||e)(d.Lb(n.b),d.Lb(n.a),d.Lb(u.e),d.Lb(g.a))},e.\u0275cmp=d.Fb({type:e,selectors:[["app-form"]],decls:11,vars:2,consts:[[1,"w-100","h-100","d-flex","flex-column","align-items-center","form-container"],[1,"row"],[1,"col-12","py-4","text-center"],[1,"h4"],["class","col-12",4,"ngFor","ngForOf"],[1,"col-12","mt-4"],[1,"d-flex","justify-content-center"],["type","button","translate","",1,"btn","btn-primary","tms-button",3,"click"],[1,"col-12"],["appFormElement","",3,"config","group"]],template:function(e,t){1&e&&(d.Rb(0,"div",0),d.Rb(1,"div",1),d.Rb(2,"div",2),d.Rb(3,"p",3),d.yc(4),d.Qb(),d.Qb(),d.Qb(),d.Rb(5,"div",1),d.wc(6,l,2,2,"div",4),d.Rb(7,"div",5),d.Rb(8,"div",6),d.Rb(9,"button",7),d.bc("click",function(){return t.submit()}),d.yc(10," general.submit "),d.Qb(),d.Qb(),d.Qb(),d.Qb(),d.Qb()),2&e&&(d.yb(4),d.zc(t.title),d.yb(2),d.ic("ngForOf",t.formConfig))},directives:[i.j,u.a,p.a],styles:[""]}),e})()}];let h=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=d.Jb({type:e}),e.\u0275inj=d.Ib({imports:[[n.e.forChild(m)],n.e]}),e})();var b=r("biST");let v=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=d.Jb({type:e}),e.\u0275inj=d.Ib({imports:[[i.b,u.c,h,b.a]]}),e})()},"o7N+":function(e,t,r){"use strict";r.d(t,"a",function(){return o});var i=r("uY3Z"),n=r("xauc"),a=r("fXoL"),s=r("bP2Y");let o=(()=>{class e{constructor(e){this.httpService=e,this.offeringPrefix="offering",this.namePrefix="name",this.starPrefix="star",this.separator="_"}getAllOfferings(e){return this.httpService.httpRequest(e?i.a.offerings+"?page="+e.page+"&limit="+e.limit+"&search="+e.search+"&orderBy="+e.sortBy+"&sortOrder="+e.sortOrder:i.a.offerings,"get")}getAllStars(){return this.httpService.httpRequest(i.a.stars,"get")}getOfferingConfigName(e){return this.offeringPrefix+this.separator+e}getPersonConfigName(e,t){return this.namePrefix+this.separator+e+this.separator+t}getStarConfigName(e,t){return this.starPrefix+this.separator+e+this.separator+t}OfferingDataToCart(e,t){let r=[];if(e)return Object.keys(e).forEach(i=>{const a=i.split(this.separator)[1];if(i.indexOf(this.namePrefix)>-1){const s=i.split(this.separator)[2];let o={offering:null,persons:[]};r[a]=r[a]?r[a]:o,r[a].offering=Object.assign(Object.assign({},e[this.offeringPrefix+this.separator+a]),{offeringDate:t[a].offeringDate?t[a].offeringDate:Object(n.e)()}),r[a].persons[s]={name:e[this.namePrefix+this.separator+a+this.separator+s],star:e[this.starPrefix+this.separator+a+this.separator+s]}}}),r=r.filter(e=>(e.persons=e.persons.filter(e=>null!==e),null!==e)),r}submitUserOffering(e){return this.httpService.httpRequest(i.a.submitOfferings,"post",e)}getTransactionDetails(e){return this.httpService.httpRequest(i.a.transactionDetails+"/"+e,"get")}getTransactionAmount(e){let t=0;return e.offerings.forEach(e=>{t+=e.price*e.devotees.length}),t}completeTransaction(e){return this.httpService.httpRequest(i.a.approveTransaction,"patch",{transactionId:e})}deleteOffering(e){return this.httpService.httpRequest(i.a.offerings+"/"+e.id,"delete")}addOffering(e){return this.httpService.httpRequest(i.a.offerings,e.id?"put":"post",e)}getOfferingDetails(e){return this.httpService.httpRequest(i.a.offerings+"/"+e,"get")}getExistingDevotees(e){return this.httpService.httpRequest(i.a.submitOfferings+"/"+e,"get")}getOfferingsHistory(e,t){let r=i.a.offeringHistory;return r+="?fromDate="+e,r+="&toDate="+t,this.httpService.httpRequest(r,"get")}}return e.\u0275fac=function(t){return new(t||e)(a.Yb(s.a))},e.\u0275prov=a.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);