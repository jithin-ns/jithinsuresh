(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{Fr2y:function(e,t,n){"use strict";n.r(t),n.d(t,"RecurringModule",function(){return N});var i=n("ofXK"),r=n("1kSV"),s=n("sYmb"),a=n("tyNb"),o=n("mrSG"),c=n("3Pt+"),g=n("52Kp"),l=n("e8pF"),f=n("xauc"),u=n("N26v"),b=n("VYn8"),d=n("UvjE"),h=n("SqtC"),p=n("ajRT"),m=n("fXoL"),v=n("o7N+"),y=n("B43R"),O=n("qfBg");let C=(()=>{class e{constructor(){this.inputValue=!1,this.valueChanged=new m.n}ngOnInit(){}ngOnChanges(){this.onChangeEvent()}onChangeEvent(){this.valueChanged.emit(this.inputValue)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=m.Fb({type:e,selectors:[["app-on-off-switch"]],inputs:{inputValue:"inputValue"},outputs:{valueChanged:"valueChanged"},features:[m.wb],decls:3,vars:1,consts:[[1,"switch"],["type","checkbox",3,"ngModel","ngModelChange","change"],[1,"slider","round"]],template:function(e,t){1&e&&(m.Rb(0,"label",0),m.Rb(1,"input",1),m.bc("ngModelChange",function(e){return t.inputValue=e})("change",function(){return t.onChangeEvent()}),m.Qb(),m.Mb(2,"span",2),m.Qb()),2&e&&(m.yb(1),m.ic("ngModel",t.inputValue))},directives:[c.a,c.k,c.m],styles:['.switch[_ngcontent-%COMP%]{position:relative;display:inline-block;width:45px;height:23px}.switch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{opacity:0;width:0;height:0}.switch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]{background-color:#2196f3}.switch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]:before{transform:translateX(22px)}.switch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus + .slider[_ngcontent-%COMP%]{box-shadow:0 0 1px #2196f3}.switch[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;transition:.4s}.switch[_ngcontent-%COMP%]   .slider.round[_ngcontent-%COMP%]{border-radius:23px}.switch[_ngcontent-%COMP%]   .slider.round[_ngcontent-%COMP%]:before{border-radius:50%}.switch[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]:before{position:absolute;content:"";height:15px;width:15px;left:4px;bottom:4px;background-color:#fff;transition:.4s}']}),e})();var D=n("1R7j"),w=n("7A/B"),R=n("F4oO");function S(e,t){if(1&e&&(m.Rb(0,"div",25),m.Rb(1,"label",26),m.yc(2," pages.offerings.offeringTotal "),m.Qb(),m.Rb(3,"label",27),m.yc(4),m.Qb(),m.Qb()),2&e){const e=m.dc().$implicit,t=m.dc();m.yb(4),m.Bc(" ",t.currency," ",e.totalAmount,"/- ")}}function x(e,t){if(1&e){const e=m.Sb();m.Rb(0,"div",20),m.Rb(1,"app-offering-form",21),m.bc("offeringDeleted",function(){m.rc(e);const n=t.index;return m.dc().calculateOfferingPrice(n)}),m.Qb(),m.wc(2,S,5,2,"div",22),m.Rb(3,"div",23),m.Rb(4,"button",24),m.bc("click",function(){m.rc(e);const n=t.index,i=t.$implicit;return m.dc().addPersons(n,i.persons.length)}),m.yc(5," pages.offerings.addPerson "),m.Qb(),m.Qb(),m.Qb()}if(2&e){const e=t.$implicit,n=m.dc();m.yb(1),m.ic("formConfig",e)("formGroup",n.formGroup)("changeFlag",n.changeFlag)("existingDevotees",n.existingDevotees),m.yb(1),m.ic("ngIf",e.totalAmount)}}function P(e,t){if(1&e){const e=m.Sb();m.Rb(0,"div",28),m.Rb(1,"button",29),m.bc("click",function(){return m.rc(e),m.dc().selectDate()}),m.yc(2," pages.offerings.select "),m.Qb(),m.Qb()}}const M=function(e){return{odd:e}};function F(e,t){if(1&e){const e=m.Sb();m.Rb(0,"div",34),m.Rb(1,"label",35),m.yc(2),m.Qb(),m.Rb(3,"a",36),m.bc("click",function(){m.rc(e);const n=t.index;return m.dc(2).deleteOfferingDate(n)}),m.Mb(4,"app-image-icon",37),m.ec(5,"translate"),m.Qb(),m.Qb()}if(2&e){const e=t.$implicit;m.ic("ngClass",m.mc(7,M,t.odd)),m.yb(2),m.zc(e.clientFormat),m.yb(2),m.ic("url","delete_cross.png")("alternateText",m.fc(5,5,"general.delete"))("parentClass","person-cart")}}const Q=function(e){return{"d-none":e}};function j(e,t){if(1&e&&(m.Rb(0,"div",30),m.Rb(1,"div",31),m.Rb(2,"div",32),m.wc(3,F,6,9,"div",33),m.Qb(),m.Qb(),m.Qb()),2&e){const e=m.dc();m.yb(2),m.ic("ngClass",m.mc(2,Q,!e.isRecurringDates)),m.yb(1),m.ic("ngForOf",e.offeringDates)}}function _(e,t){if(1&e){const e=m.Sb();m.Rb(0,"button",38),m.bc("click",function(){return m.rc(e),m.dc().active=1}),m.yc(1," general.back "),m.Qb()}}function k(e,t){if(1&e){const e=m.Sb();m.Rb(0,"button",39),m.bc("click",function(){return m.rc(e),m.dc().nextPage()}),m.yc(1," pages.offerings.next "),m.Qb()}}function G(e,t){if(1&e){const e=m.Sb();m.Rb(0,"button",39),m.bc("click",function(){return m.rc(e),m.dc().submit()}),m.yc(1," general.submit "),m.Qb()}}const I=function(e){return{"active-wizard":e}},V=[{path:"",component:(()=>{class e{constructor(e,t,n,i,r,s){this.router=e,this.translate=t,this.modalService=n,this.offeringsService=i,this.utilsService=r,this.userService=s,this.active=1,this.formGroup=new c.f({}),this.advanceBookingFormGroup=new c.f({}),this.recurringFormGroup=new c.f({}),this.offerings=[],this.existingDevotees=[],this.isRecurringDates=!1,this.isLoggedIn=!1,this.offeringDates=[],this.changeFlag=!1}ngOnInit(){this.isLoggedIn=this.userService.isAuthenticated(),this.translate.get(["pages.offerings.offering","pages.offerings.name","pages.offerings.star","pages.offerings.selectMinOneDate","pages.admin.date","form.validationErrors.mandatory","pages.admin.error","general.OK"]).subscribe(e=>{this.translations=e,this.initialize()})}initialize(){this.initializeOfferingForm(),this.initializeRecurringForm()}initializeOfferingForm(){return Object(o.a)(this,void 0,void 0,function*(){yield this.getAllOfferings(),yield this.getAllStars(),this.utilsService.getStorageValue(l.e)&&this.getExistingDevotees(),this.utilsService.getStorageValue(l.c)&&this.utilsService.isBase64(this.utilsService.getStorageValue(l.c))?(JSON.parse(g.a.decode(this.utilsService.getStorageValue(l.c))).offeringsData.forEach((e,t)=>{this.addOffering(t,e.offering),e.persons.forEach((e,n)=>{this.addPersons(t,n,e)})}),this.utilsService.removeStorageValue(l.c)):this.addOffering(0)})}initializeRecurringForm(){let e=null;this.utilsService.getStorageValue(l.c)&&this.utilsService.isBase64(this.utilsService.getStorageValue(l.c))&&(e=JSON.parse(g.a.decode(this.utilsService.getStorageValue(l.c))),e.recurringData&&(this.isRecurringDates=e.recurringData.isDates,e.recurringData.isDates&&(this.offeringDates=e.recurringData.dates)));const t=[{label:"Weekly",value:{label:"Weekly",value:"weekly"}},{label:"Monthly",value:{label:"Monthly",value:"monthly"}},{label:"Yearly",value:{label:"Yearly",value:"yearly"}}];this.recurringFormConfig={offeringDate:{type:"date",name:"offeringDate",label:"Offering date",placeholder:this.translations["pages.admin.date"],defaultValue:e&&e.recurringData&&e.recurringData.startDate?e.recurringData.startDate:Object(f.e)(),minDate:Object(f.e)(),tabIndex:"0",parentClass:"m-0"},recurrenceType:{type:"select",name:"recurrenceType",label:"Recurrence type",defaultValue:e&&e.recurringData&&e.recurringData.recurrenceType?e.recurringData.recurrenceType:t[0].value,tabIndex:"1",options:t},recurrences:{type:"number",name:"recurrences",label:"Number of recurrences",placeholder:"Number",defaultValue:e&&e.recurringData&&e.recurringData.recurrences?e.recurringData.recurrences:"",tabIndex:"2",validators:[Object.assign(Object.assign({},f.c.pattern(b.a)),{validationMsg:this.translations["form.validationErrors.invalid"]})]}},this.recurringFormGroup=Object(f.d)([this.recurringFormConfig.offeringDate,this.recurringFormConfig.recurrenceType,this.recurringFormConfig.recurrences],this.recurringFormGroup)}getExistingDevotees(){const e=this.utilsService.getStorageValue(l.e),t=this.utilsService.getLanguageExtension();this.offeringsService.getExistingDevotees(e).subscribe(e=>{this.existingDevotees=e&&e.data?Object(u.b)(e.data,t):[]})}getAllOfferings(){return new Promise(e=>{this.offeringsService.getAllOfferings().subscribe(t=>{const n=this.utilsService.getLanguageExtension();this.offeringList=t&&t.data?Object(u.f)(t.data,n):[],e(1)})})}getAllStars(){return new Promise(e=>{this.offeringsService.getAllStars().subscribe(t=>{const n=this.utilsService.getLanguageExtension();this.starsList=t&&t.data?Object(u.h)(t.data,n):[],e(1)})})}addOffering(e,t=null){const n=this.offeringsService.getOfferingConfigName(e),i={type:"autocomplete",name:n,placeholder:this.translations["pages.offerings.offering"],defaultValue:t,tabIndex:"0",options:this.offeringList,validators:[Object.assign(Object.assign({},f.c.required),{validationMsg:this.translations["form.validationErrors.mandatory"]})]},r={index:e+1,active:!0,title:t?t.label:"",offering:i,persons:[],totalAmount:0,offeringDate:t?t.offeringDate:Object(f.e)(),offeringDateText:""};this.formGroup=Object(f.d)([r.offering],this.formGroup),this.offerings.push(r),console.log(this.offerings),this.formGroup.get(n).valueChanges.subscribe(t=>{t&&t.label&&t.value?(this.calculateOfferingPrice(e),this.offerings[e].title=t.label):this.offerings[e].title=""}),t||this.addPersons(e,0)}calculateOfferingPrice(e){const t=this.offeringsService.getOfferingConfigName(e),n=this.formGroup.get(t).value;if(n&&n.value){const t=this.offerings[e].persons.filter(e=>e.active).length;this.offerings[e].totalAmount=n.value.price*t}else this.offerings[e].totalAmount=0}addPersons(e,t,n=null){const i={active:!0,name:{type:"text",name:this.offeringsService.getPersonConfigName(e,t),defaultValue:n&&n.name?n.name:"",placeholder:this.translations["pages.offerings.name"],tabIndex:"0",validators:[Object.assign(Object.assign({},f.c.required),{validationMsg:this.translations["form.validationErrors.mandatory"]})]},star:{type:"select",name:this.offeringsService.getStarConfigName(e,t),defaultValue:n&&n.star?n.star:"",placeholder:this.translations["pages.offerings.star"],tabIndex:"0",options:this.starsList,validators:[Object.assign(Object.assign({},f.c.required),{validationMsg:this.translations["form.validationErrors.mandatory"]})]}};this.formGroup=Object(f.d)([i.name,i.star],this.formGroup),this.offerings[e].persons.push(i),this.changeFlag=!this.changeFlag,this.calculateOfferingPrice(e)}changeRecurrenceType(e){this.isRecurringDates=!!e}selectDate(){let e=this.recurringFormGroup.get("offeringDate").value?Object(f.a)(this.recurringFormGroup.get("offeringDate").value):Object(f.a)();const t={apiFormat:this.utilsService.date(e).startOf("day").format(d.c),clientFormat:this.utilsService.date(e).format(d.a)};this.offeringDates.filter(e=>e.apiFormat===t.apiFormat).length||this.offeringDates.push(t)}deleteOfferingDate(e){this.offeringDates.splice(e,1)}nextPage(){this.formGroup.valid?this.active=2:this.formGroup=Object(f.f)(this.formGroup)}getOfferingData(){let e=null;return this.formGroup.valid?e=this.offeringsService.OfferingDataToCart(this.formGroup.value,this.offerings):(this.formGroup=Object(f.f)(this.formGroup),this.active=1),e}getRecurringData(){let e=null;return this.isRecurringDates?this.offeringDates.length?e={isDates:!0,dates:this.offeringDates}:this.showError(this.translations["pages.offerings.selectMinOneDate"]):e={isDates:!1,startDate:this.recurringFormGroup.get("offeringDate").value,recurrenceType:this.recurringFormGroup.get("recurrenceType").value,recurrences:this.recurringFormGroup.get("recurrences").value?this.recurringFormGroup.get("recurrences").value:"1"},e}showError(e){const t=this.modalService.open(p.a,{centered:!0});t.componentInstance.config={type:"danger",title:this.translations["pages.admin.error"],body:e,buttons:{submit:{label:this.translations["general.OK"]}}},t.componentInstance.action.subscribe(e=>{t.close()})}submit(){const e=this.getOfferingData(),t=this.getRecurringData();if(e&&t){this.utilsService.setStorageValue(l.c,g.a.encode(JSON.stringify({offeringsData:e,recurringData:t})));const n=this.isLoggedIn?[h.d,h.e].join("/"):h.e;this.router.navigate([[n].join("/")],{queryParams:{from:"recurring"}})}}}return e.\u0275fac=function(t){return new(t||e)(m.Lb(a.b),m.Lb(s.e),m.Lb(r.h),m.Lb(v.a),m.Lb(y.a),m.Lb(O.a))},e.\u0275cmp=m.Fb({type:e,selectors:[["app-recurring"]],decls:31,vars:28,consts:[[1,"row","recurring-offering-container"],[1,"col-12"],[1,"wizard"],[1,"d-flex","justify-content-between","mb-4","p-3","wizard-header"],["translate","",1,"header-item",3,"ngClass"],[1,"step-1",3,"ngClass"],["class","pt-3 px-3",4,"ngFor","ngForOf"],[1,"step-2",3,"ngClass"],[1,"row","py-1"],[3,"inputValue","valueChanged"],["translate","",1,"ml-2"],[1,"row"],[1,"col-12","py-1"],["appFormElement","",3,"config","group"],["class","col-12 py-1 text-right",4,"ngIf"],["class","card my-2",4,"ngIf"],[1,"row",3,"ngClass"],[1,"col-6","mt-4"],["type","button","class","btn btn-light tms-button mt-2","translate","",3,"click",4,"ngIf"],["type","button","class","btn btn-primary tms-button mt-2","translate","",3,"click",4,"ngIf"],[1,"pt-3","px-3"],[3,"formConfig","formGroup","changeFlag","existingDevotees","offeringDeleted"],["class","w-100 mt-2",4,"ngIf"],[1,"w-100"],["type","button","translate","",1,"btn","btn-info","tms-button","mt-2",3,"click"],[1,"w-100","mt-2"],["translate","",1,"float-left","font-weight-bold","offering-amount"],[1,"float-right","font-weight-bold","offering-amount"],[1,"col-12","py-1","text-right"],["translate","",1,"btn","btn-info",3,"click"],[1,"card","my-2"],[1,"card-body","py-2"],[1,"row","px-2",3,"ngClass"],["class","col-12 d-flex justify-content-between offering-date",3,"ngClass",4,"ngFor","ngForOf"],[1,"col-12","d-flex","justify-content-between","offering-date",3,"ngClass"],[1,"m-0","py-2"],["href","javascript:void(0);",1,"d-flex","align-items-center",3,"click"],[3,"url","alternateText","parentClass"],["type","button","translate","",1,"btn","btn-light","tms-button","mt-2",3,"click"],["type","button","translate","",1,"btn","btn-primary","tms-button","mt-2",3,"click"]],template:function(e,t){1&e&&(m.Rb(0,"div",0),m.Rb(1,"div",1),m.Rb(2,"div",2),m.Rb(3,"div",3),m.Rb(4,"div",4),m.yc(5," pages.offerings.offering "),m.Qb(),m.Rb(6,"div",4),m.yc(7," pages.offerings.recurringDetails "),m.Qb(),m.Qb(),m.Rb(8,"div",5),m.wc(9,x,6,5,"div",6),m.Qb(),m.Rb(10,"div",7),m.Rb(11,"div",8),m.Rb(12,"div",1),m.Rb(13,"app-on-off-switch",9),m.bc("valueChanged",function(e){return t.changeRecurrenceType(e)}),m.Qb(),m.Rb(14,"label",10),m.yc(15,"pages.offerings.chooseDates"),m.Qb(),m.Qb(),m.Qb(),m.Rb(16,"div",11),m.Rb(17,"div",12),m.Nb(18,13),m.Qb(),m.wc(19,P,3,0,"div",14),m.Qb(),m.wc(20,j,4,4,"div",15),m.Rb(21,"div",16),m.Rb(22,"div",12),m.Nb(23,13),m.Qb(),m.Rb(24,"div",12),m.Nb(25,13),m.Qb(),m.Qb(),m.Qb(),m.Qb(),m.Qb(),m.Rb(26,"div",17),m.wc(27,_,2,0,"button",18),m.Qb(),m.Rb(28,"div",17),m.wc(29,k,2,0,"button",19),m.wc(30,G,2,0,"button",19),m.Qb(),m.Qb()),2&e&&(m.yb(4),m.ic("ngClass",m.mc(18,I,1===t.active)),m.yb(2),m.ic("ngClass",m.mc(20,I,2===t.active)),m.yb(2),m.ic("ngClass",m.mc(22,Q,1!==t.active)),m.yb(1),m.ic("ngForOf",t.offerings),m.yb(1),m.ic("ngClass",m.mc(24,Q,2!==t.active)),m.yb(3),m.ic("inputValue",t.isRecurringDates),m.yb(5),m.ic("config",t.recurringFormConfig.offeringDate)("group",t.recurringFormGroup),m.yb(1),m.ic("ngIf",t.isRecurringDates),m.yb(1),m.ic("ngIf",t.isRecurringDates&&t.offeringDates.length),m.yb(1),m.ic("ngClass",m.mc(26,Q,t.isRecurringDates)),m.yb(2),m.ic("config",t.recurringFormConfig.recurrenceType)("group",t.recurringFormGroup),m.yb(2),m.ic("config",t.recurringFormConfig.recurrences)("group",t.recurringFormGroup),m.yb(2),m.ic("ngIf",2===t.active),m.yb(2),m.ic("ngIf",1===t.active),m.yb(1),m.ic("ngIf",2===t.active))},directives:[s.a,i.i,i.j,C,D.a,i.k,w.a,c.l,c.g,R.a],pipes:[s.d],styles:[".recurring-offering-container[_ngcontent-%COMP%]   .wizard[_ngcontent-%COMP%]   .wizard-header[_ngcontent-%COMP%]{border-bottom:1px solid #ccc}.recurring-offering-container[_ngcontent-%COMP%]   .wizard[_ngcontent-%COMP%]   .wizard-header[_ngcontent-%COMP%]   .header-item[_ngcontent-%COMP%]{font-weight:bolder;color:#ccc}.recurring-offering-container[_ngcontent-%COMP%]   .wizard[_ngcontent-%COMP%]   .wizard-header[_ngcontent-%COMP%]   .header-item.active-wizard[_ngcontent-%COMP%]{color:#000}.recurring-offering-container[_ngcontent-%COMP%]   .wizard[_ngcontent-%COMP%]   .offering-date.odd[_ngcontent-%COMP%]{background-color:#f2ecec}"]}),e})()}];let E=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=m.Jb({type:e}),e.\u0275inj=m.Ib({imports:[[a.e.forChild(V)],a.e]}),e})();var z=n("omz/"),L=n("ZtcU");let T=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=m.Jb({type:e}),e.\u0275inj=m.Ib({imports:[[i.b,c.h]]}),e})(),N=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=m.Jb({type:e}),e.\u0275inj=m.Ib({imports:[[i.b,r.j,s.c,E,z.a,L.a,T]]}),e})()}}]);